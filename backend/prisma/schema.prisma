generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String?   @db.Uuid
  user_type     String    @db.VarChar(20)
  action        String    @db.VarChar(50)
  resource_type String    @db.VarChar(50)
  resource_id   String?   @db.Uuid
  details       Json?     @default("{}")
  ip_address    String?   @db.Inet
  user_agent    String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@index([action], map: "idx_audit_logs_action")
  @@index([created_at], map: "idx_audit_logs_created_at")
  @@index([resource_type, resource_id], map: "idx_audit_logs_resource")
  @@index([resource_type, resource_id, action, created_at(sort: Desc)], map: "idx_audit_logs_resource_action_date")
  @@index([user_id], map: "idx_audit_logs_user")
  @@index([user_id, action, created_at(sort: Desc)], map: "idx_audit_logs_user_action_date")
  @@index([user_type], map: "idx_audit_logs_user_type")
}

model boat_preps {
  id                                                    String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id                                           String      @db.Uuid
  date                                                  DateTime    @db.Date
  session                                               String      @db.VarChar(50)
  boat_id                                               String?     @db.Uuid
  diver_ids                                             Json        @default("[]")
  dive_site_id                                          String?     @db.Uuid
  actual_dive_site_id                                   String?     @db.Uuid
  dive_site_status                                      Json?       @default("{}")
  post_dive_report                                      Json?       @default("{}")
  staff                                                 Json?       @default("{}")
  created_at                                            DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                                            DateTime?   @default(now()) @db.Timestamptz(6)
  dive_sites_boat_preps_actual_dive_site_idTodive_sites dive_sites? @relation("boat_preps_actual_dive_site_idTodive_sites", fields: [actual_dive_site_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  boats                                                 boats?      @relation(fields: [boat_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  dive_sites_boat_preps_dive_site_idTodive_sites        dive_sites? @relation("boat_preps_dive_site_idTodive_sites", fields: [dive_site_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                                             locations   @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([boat_id], map: "idx_boat_preps_boat")
  @@index([date], map: "idx_boat_preps_date")
  @@index([location_id], map: "idx_boat_preps_location")
}

model boats {
  id                   String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id          String       @db.Uuid
  name                 String       @db.VarChar(100)
  capacity             Int
  equipment_onboard    Json?        @default("[]")
  maintenance_schedule Json?        @default("{}")
  is_active            Boolean?     @default(true)
  created_at           DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?    @default(now()) @db.Timestamptz(6)
  boat_preps           boat_preps[]
  locations            locations    @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  bookings             bookings[]

  @@index([is_active], map: "idx_boats_active")
  @@index([location_id], map: "idx_boats_location")
}

model bono_usage {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bono_id          String           @db.Uuid
  booking_id       String           @db.Uuid
  customer_id      String           @db.Uuid
  discount_amount  Decimal          @db.Decimal(10, 2)
  usage_date       DateTime?        @default(now()) @db.Timestamptz(6)
  government_bonos government_bonos @relation(fields: [bono_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  bookings         bookings         @relation(fields: [booking_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers        customers        @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model bookings {
  id                                                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id                                       String          @db.Uuid
  location_id                                       String          @db.Uuid
  boat_id                                           String?         @db.Uuid
  dive_site_id                                      String?         @db.Uuid
  staff_primary_id                                  String?         @db.Uuid
  booking_date                                      DateTime        @db.Date
  activity_type                                     activity_type
  number_of_dives                                   Int?            @default(1)
  price                                             Decimal         @db.Decimal(10, 2)
  discount                                          Decimal?        @default(0) @db.Decimal(10, 2)
  total_price                                       Decimal         @db.Decimal(10, 2)
  payment_method                                    payment_method?
  payment_status                                    payment_status? @default(pending)
  status                                            booking_status? @default(pending)
  special_requirements                              String?
  equipment_needed                                  Json?           @default("[]")
  bono_id                                           String?         @db.Uuid
  government_payment                                Decimal?        @default(0) @db.Decimal(10, 2)
  customer_payment                                  Decimal?        @default(0) @db.Decimal(10, 2)
  dive_sequence                                     Int?            @default(1)
  stay_id                                           String?         @db.Uuid
  source                                            booking_source? @default(direct)
  partner_id                                        String?         @db.Uuid
  created_by_partner_id                             String?         @db.Uuid
  created_at                                        DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at                                        DateTime?       @default(now()) @db.Timestamptz(6)
  bono_usage                                        bono_usage[]
  boats                                             boats?          @relation(fields: [boat_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  partners_bookings_created_by_partner_idTopartners partners?       @relation("bookings_created_by_partner_idTopartners", fields: [created_by_partner_id], references: [id], onUpdate: NoAction)
  customers                                         customers       @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  dive_sites                                        dive_sites?     @relation(fields: [dive_site_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                                         locations       @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  partners_bookings_partner_idTopartners            partners?       @relation("bookings_partner_idTopartners", fields: [partner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  staff                                             staff?          @relation(fields: [staff_primary_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customer_stays                                    customer_stays? @relation(fields: [stay_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_by_partner_id], map: "idx_bookings_created_by_partner")
  @@index([customer_id], map: "idx_bookings_customer")
  @@index([partner_id], map: "idx_bookings_partner")
  @@index([source], map: "idx_bookings_source")
}

model certification_agencies {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String                    @db.VarChar(100)
  code                    String                    @unique @db.VarChar(10)
  priority                Int
  is_primary_agency       Boolean?                  @default(false)
  api_endpoint            String?                   @db.VarChar(255)
  api_key_required        Boolean?                  @default(false)
  is_active               Boolean?                  @default(true)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  customer_certifications customer_certifications[]
}

model customer_certifications {
  id                     String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id            String                 @db.Uuid
  agency_id              String                 @db.Uuid
  certification_number   String                 @db.VarChar(100)
  certification_level    String                 @db.VarChar(100)
  issue_date             DateTime               @db.Date
  expiry_date            DateTime?              @db.Date
  instructor_name        String?                @db.VarChar(100)
  dive_center            String?                @db.VarChar(100)
  api_validated          Boolean?               @default(false)
  api_data               Json?
  last_validated         DateTime?              @default(now()) @db.Timestamptz(6)
  created_at             DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?              @default(now()) @db.Timestamptz(6)
  certification_agencies certification_agencies @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers              customers              @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([customer_id], map: "idx_certifications_customer")
}

model customer_consents {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id     String         @db.Uuid
  consent_type    consent_type
  consent_given   Boolean
  consent_date    DateTime       @default(now()) @db.Timestamptz(6)
  consent_method  consent_method @default(online)
  ip_address      String?        @db.Inet
  user_agent      String?
  withdrawal_date DateTime?      @db.Timestamptz(6)
  is_active       Boolean?       @default(true)
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?      @default(now()) @db.Timestamptz(6)
  customers       customers      @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_customer_consents_active")
  @@index([customer_id], map: "idx_customer_consents_customer")
  @@index([customer_id, consent_type, is_active], map: "idx_customer_consents_customer_type_active")
  @@index([consent_type], map: "idx_customer_consents_type")
}

model customer_stays {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id     String     @db.Uuid
  stay_start_date DateTime   @db.Date
  stay_end_date   DateTime?  @db.Date
  status          status?    @default(active)
  total_dives     Int?       @default(0)
  total_spent     Decimal?   @default(0) @db.Decimal(10, 2)
  created_at      DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?  @default(now()) @db.Timestamptz(6)
  bookings        bookings[]
  customers       customers  @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([customer_id], map: "idx_customer_stays_customer")
}

model customers {
  id                                                 String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  first_name                                         String                         @db.VarChar(50)
  last_name                                          String                         @db.VarChar(50)
  email                                              String?                        @db.VarChar(100)
  phone                                              String?                        @db.VarChar(20)
  dob                                                DateTime?                      @db.Date
  nationality                                        String?                        @db.VarChar(50)
  address                                            Json?                          @default("{}")
  customer_type                                      customer_type?
  preferences                                        Json?                          @default("{}")
  medical_conditions                                 Json?                          @default("[]")
  restrictions                                       Json?                          @default("{}")
  notes                                              String?
  is_active                                          Boolean?                       @default(true)
  created_at                                         DateTime?                      @default(now()) @db.Timestamptz(6)
  updated_at                                         DateTime?                      @default(now()) @db.Timestamptz(6)
  deleted_at                                         DateTime?                      @db.Timestamptz(6)
  anonymized                                         Boolean?                       @default(false)
  deletion_reason                                    String?
  source                                             booking_source?                @default(direct)
  partner_id                                         String?                        @db.Uuid
  created_by_partner_id                              String?                        @db.Uuid
  bono_usage                                         bono_usage[]
  bookings                                           bookings[]
  customer_bills                                     customer_bills[]
  customer_certifications                            customer_certifications[]
  customer_consents                                  customer_consents[]
  customer_stays                                     customer_stays[]
  partners_customers_created_by_partner_idTopartners partners?                      @relation("customers_created_by_partner_idTopartners", fields: [created_by_partner_id], references: [id], onUpdate: NoAction)
  partners_customers_partner_idTopartners            partners?                      @relation("customers_partner_idTopartners", fields: [partner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  data_subject_access_requests                       data_subject_access_requests[]

  @@index([anonymized], map: "idx_customers_anonymized")
  @@index([created_by_partner_id], map: "idx_customers_created_by_partner")
  @@index([deleted_at], map: "idx_customers_deleted_at")
  @@index([email], map: "idx_customers_email")
  @@index([partner_id], map: "idx_customers_partner")
  @@index([source], map: "idx_customers_source")
}

model data_breaches {
  id                             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  breach_type                    breach_type
  severity                       severity    @default(medium)
  description                    String
  detected_at                    DateTime    @default(now()) @db.Timestamptz(6)
  occurred_at                    DateTime?   @db.Timestamptz(6)
  affected_data_types            data_type[] @default([])
  affected_customers_count       Int?        @default(0)
  affected_customer_ids          String[]    @db.Uuid
  root_cause                     String?
  containment_measures           String?
  mitigation_actions             String?
  status                         String      @default("detected") @db.VarChar(20)
  reported_to_authority          Boolean?    @default(false)
  authority_notification_date    DateTime?   @db.Timestamptz(6)
  authority_name                 String?     @db.VarChar(255)
  customer_notification_required Boolean?    @default(false)
  customer_notification_date     DateTime?   @db.Timestamptz(6)
  customers_notified_count       Int?        @default(0)
  notification_deadline          DateTime    @db.Timestamptz(6)
  resolved_at                    DateTime?   @db.Timestamptz(6)
  reported_by                    String?     @db.Uuid
  assigned_to                    String?     @db.Uuid
  notes                          String?
  created_at                     DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime?   @default(now()) @db.Timestamptz(6)

  @@index([detected_at], map: "idx_data_breaches_detected_at")
  @@index([notification_deadline], map: "idx_data_breaches_notification_deadline")
  @@index([reported_to_authority], map: "idx_data_breaches_reported_to_authority")
  @@index([severity], map: "idx_data_breaches_severity")
  @@index([status], map: "idx_data_breaches_status")
}

model data_subject_access_requests {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id              String    @db.Uuid
  request_type             String    @default("access") @db.VarChar(50)
  status                   String    @default("pending") @db.VarChar(20)
  requested_at             DateTime  @default(now()) @db.Timestamptz(6)
  completed_at             DateTime? @db.Timestamptz(6)
  deadline                 DateTime  @db.Timestamptz(6)
  requested_by             String?   @db.VarChar(100)
  request_details          Json?     @default("{}")
  response_data            Json?
  response_format          String?   @db.VarChar(20)
  response_delivery_method String?   @db.VarChar(50)
  response_delivered_at    DateTime? @db.Timestamptz(6)
  rejection_reason         String?
  notes                    String?
  created_at               DateTime? @default(now()) @db.Timestamptz(6)
  updated_at               DateTime? @default(now()) @db.Timestamptz(6)
  customers                customers @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([customer_id], map: "idx_dsar_customer")
  @@index([deadline], map: "idx_dsar_deadline")
  @@index([requested_at], map: "idx_dsar_requested_at")
  @@index([status], map: "idx_dsar_status")
}

model dive_sites {
  id                                                    String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id                                           String        @db.Uuid
  name                                                  String        @db.VarChar(100)
  type                                                  activity_type
  depth_range                                           Json
  difficulty_level                                      String        @db.VarChar(50)
  conditions                                            Json?         @default("{}")
  is_active                                             Boolean?      @default(true)
  created_at                                            DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at                                            DateTime?     @default(now()) @db.Timestamptz(6)
  boat_preps_boat_preps_actual_dive_site_idTodive_sites boat_preps[]  @relation("boat_preps_actual_dive_site_idTodive_sites")
  boat_preps_boat_preps_dive_site_idTodive_sites        boat_preps[]  @relation("boat_preps_dive_site_idTodive_sites")
  bookings                                              bookings[]
  locations                                             locations     @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([location_id], map: "idx_dive_sites_location")
}

model equipment {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id   String         @db.Uuid
  name          String         @db.VarChar(100)
  category      equipment_type
  type          equipment_type
  size          String?        @db.VarChar(50)
  condition     String?        @db.VarChar(50)
  serial_number String?        @db.VarChar(100)
  is_available  Boolean?       @default(true)
  is_active     Boolean?       @default(true)
  created_at    DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?      @default(now()) @db.Timestamptz(6)
  locations     locations      @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([category], map: "idx_equipment_category")
  @@index([location_id], map: "idx_equipment_location")
}

model government_bonos {
  id                  String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                String       @unique @db.VarChar(50)
  type                String       @db.VarChar(50)
  discount_percentage Decimal?     @db.Decimal(5, 2)
  max_amount          Decimal?     @db.Decimal(10, 2)
  valid_from          DateTime     @db.Date
  valid_until         DateTime     @db.Date
  usage_limit         Int?
  current_usage       Int?         @default(0)
  is_active           Boolean?     @default(true)
  created_at          DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?    @default(now()) @db.Timestamptz(6)
  bono_usage          bono_usage[]
}

model locations {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String            @db.VarChar(100)
  type            String            @db.VarChar(50)
  address         Json
  contact_info    Json
  settings        Json?             @default("{}")
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  boat_preps      boat_preps[]
  boats           boats[]
  bookings        bookings[]
  customer_bills  customer_bills[]
  dive_sites      dive_sites[]
  equipment       equipment[]
  pricing_configs pricing_configs[]
  staff           staff[]

  @@index([is_active], map: "idx_locations_active")
  @@index([type], map: "idx_locations_type")
}

model customer_bills {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id         String    @db.Uuid
  location_id         String    @db.Uuid
  bill_number         String    @unique @db.VarChar(100)
  stay_start_date     DateTime  @db.Date
  bill_date           DateTime  @db.Date
  booking_ids         Json      @default("[]")
  bill_items          Json      @default("[]")
  subtotal            Decimal   @db.Decimal(10, 2)
  tax                 Decimal   @db.Decimal(10, 2)
  total               Decimal   @db.Decimal(10, 2)
  partner_paid_total  Decimal?  @default(0) @db.Decimal(10, 2)
  customer_paid_total Decimal?  @default(0) @db.Decimal(10, 2)
  partner_tax         Decimal?  @default(0) @db.Decimal(10, 2)
  customer_tax        Decimal?  @default(0) @db.Decimal(10, 2)
  breakdown           Json?     @default("{}")
  notes               String?
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  customers           customers @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations           locations @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([bill_date], map: "idx_customer_bills_date")
  @@index([bill_number], map: "idx_customer_bills_number")
  @@index([customer_id], map: "idx_customer_bills_customer")
  @@index([stay_start_date], map: "idx_customer_bills_stay_start")
}

model partner_invoices {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  partner_id         String    @db.Uuid
  invoice_number     String    @unique @db.VarChar(50)
  customer_id        String?   @db.Uuid
  bill_id            String?   @db.VarChar(100)
  location_id        String    @db.Uuid
  invoice_date       DateTime  @db.Date
  due_date           DateTime  @db.Date
  payment_terms_days Int       @default(30)
  subtotal           Decimal   @db.Decimal(10, 2)
  tax                Decimal   @db.Decimal(10, 2)
  total              Decimal   @db.Decimal(10, 2)
  paid_amount        Decimal?  @default(0) @db.Decimal(10, 2)
  status             String    @default("pending") @db.VarChar(20)
  booking_ids        Json?     @default("[]")
  notes              String?
  paid_at            DateTime? @db.Timestamptz(6)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  partners           partners  @relation(fields: [partner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([due_date], map: "idx_partner_invoices_due_date")
  @@index([invoice_number], map: "idx_partner_invoices_number")
  @@index([partner_id], map: "idx_partner_invoices_partner")
  @@index([status], map: "idx_partner_invoices_status")
}

model partners {
  id                                                  String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                                                String             @db.VarChar(100)
  company_name                                        String             @db.VarChar(200)
  contact_email                                       String             @unique @db.VarChar(100)
  contact_phone                                       String?            @db.VarChar(20)
  api_key                                             String             @unique @db.VarChar(255)
  api_secret_hash                                     String             @db.VarChar(255)
  webhook_url                                         String?            @db.VarChar(255)
  commission_rate                                     Decimal?           @db.Decimal(5, 2)
  allowed_locations                                   String[]           @db.Uuid
  is_active                                           Boolean?           @default(true)
  settings                                            Json?              @default("{}")
  created_at                                          DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at                                          DateTime?          @default(now()) @db.Timestamptz(6)
  bookings_bookings_created_by_partner_idTopartners   bookings[]         @relation("bookings_created_by_partner_idTopartners")
  bookings_bookings_partner_idTopartners              bookings[]         @relation("bookings_partner_idTopartners")
  customers_customers_created_by_partner_idTopartners customers[]        @relation("customers_created_by_partner_idTopartners")
  customers_customers_partner_idTopartners            customers[]        @relation("customers_partner_idTopartners")
  partner_invoices                                    partner_invoices[]

  @@index([is_active], map: "idx_partners_active")
  @@index([api_key], map: "idx_partners_api_key")
}

model pricing_configs {
  id                    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id           String?        @db.Uuid
  pricing_type          String         @default("standard") @db.VarChar(50)
  activity_type         activity_type?
  activity_reference_id String?        @db.Uuid
  name                  String         @db.VarChar(100)
  description           String?
  pricing_rules         Json
  conditions            Json?          @default("{}")
  priority              Int?           @default(0)
  valid_from            DateTime       @db.Date
  valid_until           DateTime?      @db.Date
  is_active             Boolean?       @default(true)
  created_at            DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?      @default(now()) @db.Timestamptz(6)
  locations             locations?     @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model settings {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key         String    @unique @db.VarChar(100)
  value       Json      @default("{}")
  description String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
}

model staff {
  id                    String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location_id           String     @db.Uuid
  location_ids          String[]   @default([]) @db.Uuid
  first_name            String     @db.VarChar(50)
  last_name             String     @db.VarChar(50)
  email                 String     @unique @db.VarChar(100)
  phone                 String?    @db.VarChar(20)
  role                  staff_role
  certifications        Json?      @default("[]")
  emergency_contact     Json?      @default("{}")
  employment_start_date DateTime?  @db.Date
  is_active             Boolean?   @default(true)
  created_at            DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?  @default(now()) @db.Timestamptz(6)
  bookings              bookings[]
  locations             locations  @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([location_id], map: "idx_staff_location")
  @@index([role], map: "idx_staff_role")
}

model users {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username        String    @unique @db.VarChar(100)
  name            String    @db.VarChar(200)
  email           String?   @unique @db.VarChar(100)
  password_hash   String    @db.VarChar(255)
  role            user_role @default(admin)
  permissions     String[]  @default([])
  location_access String[]  @default([]) @db.Uuid
  is_active       Boolean?  @default(true)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@index([is_active], map: "idx_users_active")
  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
  @@index([username], map: "idx_users_username")
}

enum activity_type {
  diving
  snorkeling
  try_dive
  discovery
  specialty
}

enum booking_source {
  direct
  partner
  walk_in
  phone
}

enum booking_status {
  pending
  confirmed
  completed
  cancelled
  no_show
}

enum breach_type {
  unauthorized_access
  data_loss
  data_disclosure
  data_modification
  other
}

enum briefing_type {
  safety_briefing
  dive_briefing
  equipment_briefing
  emergency_briefing
}

enum certification_type {
  recreational
  professional
}

enum claim_type {
  equipment_damage
  customer_injury
  equipment_loss
  liability
  medical
  other
}

enum clearance_type {
  medical_clearance
  diving_fitness
  safety_clearance
}

enum consent_method {
  online
  paper
  verbal
  implied
}

enum consent_type {
  marketing
  data_processing
  photo_video
  medical_clearance
  medical_data
}

enum contact_type {
  emergency
  veterinary
  chamber
  coast_guard
  medical
  police
  ambulance
  fire_dept
  other
}

enum customer_type {
  tourist
  local
  recurrent
}

enum data_type {
  customer_data
  booking_data
  financial_data
  equipment_data
  staff_data
  certification_data
  medical_data
}

enum deletion_trigger {
  retention_policy
  customer_request
  business_requirement
  legal_requirement
}

enum equipment_type {
  diving
  snorkeling
  accessory
}

enum incident_type {
  equipment_failure
  medical
  weather
  boat_problem
  lost_equipment
  customer_complaint
  other
}

enum payment_method {
  cash
  card
  stripe
  bank_transfer
  voucher
  government_bono
  deferred
}

enum payment_status {
  pending
  partial
  paid
  refunded
}

enum provider_type {
  insurance
  equipment_service
  training
  legal
  medical
  other
}

enum restriction_level {
  none
  restricted
  banned
}

enum severity {
  low
  medium
  high
  critical
}

enum staff_role {
  owner
  manager
  instructor
  divemaster
  assistant
  admin
  boat_captain
  mechanic
  intern
}

enum status {
  active
  inactive
  pending
  completed
  cancelled
}

enum user_role {
  superadmin
  admin
  boat_pilot
  guide
  trainer
  intern
}

enum withdrawal_method {
  online
  paper
  email
  verbal
}
