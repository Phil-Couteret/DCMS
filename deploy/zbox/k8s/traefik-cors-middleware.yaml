# Traefik CORS middleware - adds CORS headers at Ingress level
# Handles preflight (OPTIONS) requests before they reach the backend
# Requires Traefik CRDs. If apply fails with "no matches for kind Middleware",
# install: kubectl apply -f https://raw.githubusercontent.com/traefik/traefik/v2.10/docs/content/reference/dynamic-configuration/kubernetes-crd-definition-v1.yml
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: cors-headers
  namespace: dcms
spec:
  headers:
    accessControlAllowMethods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
      - PATCH
    accessControlAllowHeaders:
      - "*"
    accessControlAllowOriginList:
      - "http://admin.couteret.fr"
      - "https://admin.couteret.fr"
      - "http://dcms.couteret.fr"
      - "https://dcms.couteret.fr"
      - "http://api.couteret.fr"
      - "https://api.couteret.fr"
    accessControlAllowCredentials: true
    accessControlMaxAge: 86400
    addVaryHeader: true
